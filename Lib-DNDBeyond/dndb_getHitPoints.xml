<net.rptools.maptool.model.MacroButtonProperties>
  <macroUUID>12867d2e-bae1-41c3-ba35-51af5a13466b</macroUUID>
  <saveLocation>Token</saveLocation>
  <index>57</index>
  <colorKey>default</colorKey>
  <hotKey>None</hotKey>
  <command>[h: toon = arg (0)]

&lt;!-- HP --&gt;
[h: totalLevel = 0]
[h: classArry = ""]

[h, foreach (class, json.path.read (toon, "data.classes")), code: {
	[h: level = json.get (class, "level")]
	[h: totalLevel = totalLevel + level]
	[h: className = json.path.read (class, "definition.name")]
	[h: classObj = json.set ("", "className", className, "level", level)]
	[h: hitDice = json.path.read (class, "definition.hitDice")]
	[h: classObj = json.set (classObj, "hitDice", hitDice)]
	[h: classArry = json.append (classArry, classObj)]
}]

[h: abilities = dndb_getAbilities (toon)]
[h: baseHp =  json.path.read (toon, "data.baseHitPoints")]
[h: maxHp = baseHp + (json.get (abilities, "conBonus") * totalLevel)]
[h: damageTaken = json.path.read (toon, "data.removedHitPoints")]
[h: temporaryHitPoints = json.path.read (toon, "data.temporaryHitPoints")]
[h: maxHpModifier = json.path.read (toon, "data.bonusHitPoints")]
[h: overrideMaxHp = json.path.read (toon, "data.overrideHitPoints")]
[h, if (maxHpModifier != "" &amp;&amp; isNumber (maxHpModifier)): maxHp = maxHp + number (maxHpModifier)]
[h, if (overrideMaxHp != "" &amp;&amp; isNumber (overrideMaxHp)): maxHp = number (overrideMaxHp)]

[h: hitPoints =  json.set ("",
							"maxHp", maxHp,
							"currentHp", maxHp - damageTaken,
							"tempHp", temporaryHitPoints)]
[h: macro.return = hitPoints]</command>
  <label>dndb_getHitPoints</label>
  <group>Character</group>
  <sortby/>
  <autoExecute>true</autoExecute>
  <includeLabel>false</includeLabel>
  <applyToTokens>false</applyToTokens>
  <fontColorKey>black</fontColorKey>
  <fontSize>1.00em</fontSize>
  <minWidth/>
  <maxWidth/>
  <allowPlayerEdits>false</allowPlayerEdits>
  <toolTip/>
  <displayHotKey>true</displayHotKey>
  <commonMacro>false</commonMacro>
  <compareGroup>true</compareGroup>
  <compareSortPrefix>true</compareSortPrefix>
  <compareCommand>true</compareCommand>
  <compareIncludeLabel>true</compareIncludeLabel>
  <compareAutoExecute>true</compareAutoExecute>
  <compareApplyToSelectedTokens>true</compareApplyToSelectedTokens>
</net.rptools.maptool.model.MacroButtonProperties>
